import csv
import pickle

with open('blacklist.pkl', 'rb') as file:
        obj = list(map(str.lower, pickle.load(file)))
        
def check_libs(data):
    count = 0
    libs = data.split()
    for lib in libs:
        if lib in obj:
            count += 1
    return count

with open('brazilian-malware.csv', encoding='utf-8') as file, open('dataset2.csv', 'a', encoding='utf-8', newline='') as output:
    rows = csv.reader(file)
    writer = csv.writer(output)
    count = 0
    writer.writerow(['CountLibs', 'Entropy', 'IsMalware'])
    next(rows)
    for row in rows:
        entropy, count_libs = float(row[4]), check_libs(row[10])
        if 2 < count_libs < 250 and entropy > 1:
            count += 1
            writer.writerow([count_libs, entropy, 1])
        if count == 4000:
            break
